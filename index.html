<!doctype html>
<html lang="en-KE">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Golden Star Restaurant - Order & Pay directly from table">
  <meta name="author" content="Golden Star Restaurant">
  <title>Golden Star Restaurant ‚Äî Order & Pay</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚≠ê</text></svg>">
  <style>
    :root{
      --primary:#111111;
      --secondary:#C9A24D;
      --accent:#1f6f3a;
      --light:#fffdf5;
      --dark:#101415;
      --card:#ffffff;
      --muted:rgba(16,20,21,.72);
      --muted2:rgba(16,20,21,.55);
      --stroke:rgba(16,20,21,.12);
      --shadow: 0 18px 55px rgba(0,0,0,.10);
      --radius:18px;
      --max:1100px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 20% 0%, rgba(201,162,77,.16) 0%, transparent 60%),
                  radial-gradient(900px 700px at 100% 20%, rgba(31,111,58,.10) 0%, transparent 55%),
                  linear-gradient(135deg, var(--light) 0%, #f6f6f6 100%);
      color:var(--dark);
    }
    header{
      position:sticky; top:0; z-index:5;
      backdrop-filter: blur(10px);
      background: linear-gradient(90deg, rgba(17,17,17,.96), rgba(0,0,0,.90));
      border-bottom:1px solid rgba(255,255,255,.18);
      color:#fff;
    }
    .wrap{max-width:var(--max); margin:0 auto; padding:16px}
    .top{
      display:flex; gap:14px; align-items:center; justify-content:space-between;
      flex-wrap:wrap;
    }
    .brand{display:flex; gap:12px; align-items:center}
    .logoImg{
      width:56px; height:56px; border-radius:16px;
      background: rgba(255,255,255,.10);
      border:2px solid rgba(255,255,255,.28);
      padding:6px;
      object-fit:contain;
      box-shadow: 0 10px 24px rgba(0,0,0,.18);
      backdrop-filter: blur(6px);
      display:block;
    }
    .title h1{margin:0; font-size:18px; line-height:1.1; color:var(--secondary); font-weight:950; letter-spacing:.2px}
    .title p{margin:3px 0 0; color:rgba(255,255,255,.82); font-size:13px}
    .controls{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .search{
      display:flex; align-items:center; gap:8px;
      border:1px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.10);
      border-radius:999px;
      padding:8px 12px;
      min-width:240px;
    }
    .search input{
      border:0; outline:0; background:transparent; color:#fff;
      width:100%;
      font-size:14px;
    }
    .pill{
      border:1px solid rgba(255,255,255,.26);
      background: rgba(255,255,255,.12);
      color:#fff;
      padding:9px 12px;
      border-radius:999px;
      font-size:13px;
      font-weight:800;
      cursor:pointer;
      transition: transform .15s ease, background .15s ease;
    }
    .pill:hover{transform:translateY(-1px); background: rgba(255,255,255,.18);}
    .pill.active{
      border-color: rgba(201,162,77,.75);
      background: rgba(201,162,77,.22);
      color:#fff;
    }

    main .wrap{padding-top:18px; padding-bottom:88px}

    .section{
      margin:18px 0 10px;
      display:flex; align-items:baseline; justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .section h2{margin:0; font-size:16px; color:var(--primary); font-weight:950}
    .section small{color:rgba(16,20,21,.62); font-weight:700}

    .grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:14px;
    }
    @media (max-width:820px){
      .grid{grid-template-columns:1fr}
      .search{min-width: 180px}
    }

    .card{
      position:relative;
      overflow:hidden;
      padding:0;
      min-height: 360px;
      background:#0b0f10;
      border:1px solid rgba(16,20,21,.12);
      box-shadow: var(--shadow);
      border-radius:var(--radius);
    }
    .card .bg{
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit:cover;
      transform: scale(1.03);
      filter: saturate(1.05) contrast(1.05);
    }
    .card .shade{
      position:absolute; inset:0;
      background:
        linear-gradient(180deg, rgba(0,0,0,.45) 0%, rgba(0,0,0,.10) 35%, rgba(0,0,0,.80) 100%);
    }
    .card .overlay{
      position:absolute; inset:0;
      display:flex; flex-direction:column; justify-content:space-between;
      padding:14px;
      color:#fff;
    }
    .card .topline{display:flex; align-items:flex-start; justify-content:space-between; gap:10px}
    .card .name{
      font-weight:950;
      font-size:18px;
      line-height:1.05;
      letter-spacing:.2px;
      text-shadow: 0 10px 24px rgba(0,0,0,.45);
      max-width: 75%;
    }
    .card .meta{display:flex; gap:8px; flex-wrap:wrap}
    .card .tag{
      background: rgba(0,0,0,.45);
      border:1px solid rgba(255,255,255,.18);
      color:#fff;
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      backdrop-filter: blur(8px);
    }
    .card .bottom{
      background: rgba(0,0,0,.40);
      border:1px solid rgba(255,255,255,.14);
      border-radius: 16px;
      padding:12px;
      backdrop-filter: blur(10px);
    }
    .card .bullets{margin:0; padding-left:16px}
    .card .bullets li{color: rgba(255,255,255,.92)}
    .card .row{
      margin-top:10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }
    .card .price{
      color: var(--secondary);
      font-weight: 950;
      font-size: 18px;
    }
    .card .small{color: rgba(255,255,255,.78)}

    .card .btn{
      border:0;
      background: linear-gradient(135deg, var(--secondary), #ffd98a);
      color:var(--primary);
      font-weight:900;
      padding:10px 16px;
      border-radius:12px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:6px;
      white-space: nowrap;
      font-size: 14px;
      transition: all 0.2s ease;
    }
    .card .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(201, 162, 77, 0.3);
    }
    .card .btn:active{transform: translateY(0);}

    .btn{
      border:0;
      background: linear-gradient(135deg, var(--secondary), #ffd98a);
      color:var(--primary);
      font-weight:900;
      padding:10px 16px;
      border-radius:12px;
      cursor:pointer;
      display:inline-flex; align-items:center; gap:8px;
      transition: all 0.2s ease;
    }
    .btn:hover{transform: translateY(-1px)}
    .btn:active{transform: translateY(0)}
    .btn.secondary{
      background: #fff;
      color:var(--primary);
      border:1px solid rgba(16,20,21,.14);
      font-weight:700;
    }
    .btn.success{
      background: linear-gradient(135deg, #1f6f3a, #2a8c4a);
      color: white;
    }

    .floating{
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom:16px;
      width:min(var(--max), calc(100% - 24px));
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      padding:12px 14px;
      border-radius:16px;
      border:1px solid rgba(16,20,21,.12);
      background: rgba(255,255,255,.96);
      backdrop-filter: blur(10px);
      box-shadow: 0 16px 40px rgba(0,0,0,.14);
      z-index:10;
    }
    .floating .left{display:flex; flex-direction:column; gap:3px;}
    .floating .left b{font-size:14px; color:var(--primary)}
    .floating .left span{font-size:12px; color:rgba(16,20,21,.62); font-weight:700}
    .floating .right{display:flex; gap:10px; align-items:center}
    .count{
      display:inline-flex; align-items:center; justify-content:center;
      min-width:28px; height:28px;
      border-radius:999px;
      background: rgba(31,111,58,.12);
      border:1px solid rgba(31,111,58,.30);
      color: #0b3d22;
      font-weight:950;
      padding:0 10px;
      font-size:12px;
    }

    .modal{
      position:fixed; inset:0;
      background: rgba(0,0,0,.6);
      display:none;
      align-items:flex-end;
      justify-content:center;
      padding:14px;
      z-index:20;
    }
    .modal.open{display:flex}
    .sheet{
      width:min(var(--max), 100%);
      border-radius:18px;
      border:1px solid rgba(16,20,21,.12);
      background: #ffffff;
      box-shadow: 0 20px 60px rgba(0,0,0,.18);
      overflow:hidden;
    }
    .sheetHead{
      padding:14px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom:1px solid rgba(16,20,21,.10);
      background: linear-gradient(90deg, rgba(17,17,17,.96), rgba(0,0,0,.90));
      color:#fff;
    }
    .sheetHead b{font-size:15px}
    .sheetBody{padding:14px; display:grid; gap:10px; max-height:55vh; overflow:auto}
    .line{
      display:flex; gap:10px; align-items:flex-start; justify-content:space-between;
      border:1px solid rgba(16,20,21,.10);
      background: rgba(255,255,255,.92);
      border-radius:14px;
      padding:10px;
    }
    .line .info{display:grid; gap:3px}
    .line .info b{font-size:14px}
    .line .info small{color:var(--muted2)}
    .qty{display:flex; gap:8px; align-items:center;}
    .iconBtn{
      width:34px; height:34px; border-radius:10px;
      border:1px solid rgba(16,20,21,.14);
      background: #fff;
      color:var(--primary);
      cursor:pointer;
      font-weight:900;
    }
    .totalRow{
      display:flex; align-items:center; justify-content:space-between;
      padding:14px;
      border-top:1px solid rgba(16,20,21,.10);
      background: rgba(255,250,240,.80);
    }
    .totalRow b{font-size:15px}

    .payment-options{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap:12px;
      margin:15px 0;
    }
    .payment-option{
      border:2px solid rgba(16,20,21,.10);
      border-radius:12px;
      padding:14px;
      text-align:center;
      cursor:pointer;
      transition: all 0.2s ease;
      background: white;
    }
    .payment-option:hover{
      border-color: var(--secondary);
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }
    .payment-option.selected{
      border-color: var(--accent);
      background: rgba(31,111,58,.05);
    }
    .payment-option .icon{font-size:28px; margin-bottom:8px;}
    .payment-option .name{font-weight:800; font-size:14px; margin-bottom:4px;}
    .payment-option .desc{font-size:11px; color:var(--muted2);}

    .payment-details{
      margin-top:15px;
      padding:15px;
      background: rgba(255,250,240,.80);
      border-radius:12px;
      border:1px solid rgba(16,20,21,.10);
    }
    .payment-details.hidden{display:none}

    .mpesa-details{
      background: rgba(31,111,58,.05);
      border:1px solid rgba(31,111,58,.15);
      border-radius:10px;
      padding:12px;
      margin-bottom:10px;
    }
    .mpesa-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .copy-btn{
      background: rgba(31,111,58,.10);
      border:1px solid rgba(31,111,58,.20);
      border-radius:6px;
      padding:4px 8px;
      font-size:11px;
      cursor:pointer;
      white-space:nowrap;
    }

    .success-screen{text-align:center; padding:30px 20px;}
    .success-icon{font-size:48px; margin-bottom:15px; color:var(--accent);}
    .success-screen h3{margin:0 0 10px 0; color:var(--accent);}
    .success-screen p{color:var(--muted2); margin-bottom:20px;}
    .order-id{
      background: rgba(201,162,77,.10);
      border:1px solid rgba(201,162,77,.20);
      border-radius:8px;
      padding:10px;
      font-family: monospace;
      font-weight:800;
      letter-spacing:1px;
      margin:10px 0;
      text-align:center;
    }

    .table-status{
      display:inline-flex;
      align-items:center;
      gap:6px;
      background: rgba(31,111,58,.08);
      border:1px solid rgba(31,111,58,.15);
      border-radius:999px;
      padding:6px 12px;
      font-size:12px;
      font-weight:700;
      color:var(--accent);
    }
    .table-status select{
      border:1px solid rgba(255,255,255,.25);
      background: rgba(255,255,255,.08);
      color:#fff;
      border-radius:8px;
      padding:6px 10px;
      font-weight:800;
      outline:none;
    }
    .table-status option{color:#111}
    
    /* PAYSTACK STYLES */
    .paystack-processing {
      text-align: center;
      padding: 20px;
    }
    .paystack-processing .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .phone-input {
      width: 100%;
      padding: 12px;
      border: 1px solid rgba(16,20,21,.2);
      border-radius: 10px;
      font-size: 15px;
      margin-bottom: 10px;
    }
  </style>
</head>

<body>
<header>
  <div class="wrap top">
    <div class="brand">
      <img class="logoImg"
           src="https://i.ibb.co/S7PTSxV2/366441906-199503619771146-2457626318855539694-n.jpg"
           alt="Golden Star Restaurant Logo"
           width="56"
           height="56"
           loading="lazy">
      <div class="title">
        <h1>Golden Star Restaurant</h1>
        <p>Order & Pay directly from table</p>
        <p style="font-size: 11px; color: rgba(255,255,255,0.7); margin-top: 4px;">
          üìç Banda Street, Nairobi ‚Ä¢ üåê goldenstar.co.ke
        </p>
      </div>
    </div>

    <div class="controls">
      <div class="table-status" id="tableStatus">
        <span>üè† Table:</span>
        <select id="tableNumber">
          <option value="">Select Table</option>
          <option value="1">Table 1</option>
          <option value="2">Table 2</option>
          <option value="3">Table 3</option>
          <option value="4">Table 4</option>
          <option value="5">Table 5</option>
          <option value="6">Table 6</option>
          <option value="7">Table 7</option>
          <option value="8">Table 8</option>
          <option value="9">Table 9</option>
          <option value="10">Table 10</option>
          <option value="VIP 1">VIP 1</option>
          <option value="VIP 2">VIP 2</option>
          <option value="Take Away">Take Away</option>
          <option value="Delivery">Delivery</option>
        </select>
      </div>

      <div class="search">
        <span style="opacity:.7" aria-hidden="true">üîé</span>
        <input id="q" placeholder="Search menu..." type="text" aria-label="Search menu items">
      </div>

      <button class="pill active" data-cat="All" aria-label="Show all menu items">All</button>
      <button class="pill" data-cat="Breakfast" aria-label="Show breakfast items">Breakfast</button>
      <button class="pill" data-cat="Lunch" aria-label="Show lunch items">Lunch</button>
      <button class="pill" data-cat="Specials" aria-label="Show specials">Specials</button>
      <button class="pill" data-cat="Drinks" aria-label="Show drinks">Drinks</button>
    </div>
  </div>
</header>

<main>
  <div class="wrap">
    <div class="section">
      <h2>Menu</h2>
      <small>Select items, choose payment method, and order directly to kitchen</small>
    </div>

    <div id="grid" class="grid"></div>
  </div>
</main>

<!-- Floating Cart -->
<div class="floating" role="region" aria-label="Order summary">
  <div class="left">
    <b>Your Order ‚Ä¢ <span id="currentTable">No Table Selected</span></b>
    <span id="summary">No items yet</span>
  </div>
  <div class="right">
    <span class="count" id="count" aria-live="polite">0</span>
    <button class="btn secondary" id="openCart" aria-label="View your order">Review Order</button>
    <button class="btn success" id="checkoutBtn" aria-label="Proceed to checkout" disabled>Checkout</button>
  </div>
</div>

<!-- Cart Modal -->
<div class="modal" id="cartModal" role="dialog" aria-labelledby="cartTitle" aria-hidden="true">
  <div class="sheet">
    <div class="sheetHead">
      <b id="cartTitle">Order Summary ‚Ä¢ <span id="modalTable">Table: --</span></b>
      <button class="btn secondary" id="closeCart" aria-label="Close order summary">Close</button>
    </div>
    <div class="sheetBody" id="cartLines"></div>
    <div class="totalRow">
      <div>
        <b id="total">Total: KES 0</b><br>
        <span class="small" id="orderNote"></span>
      </div>
      <button class="btn success" id="proceedToPayment">Proceed to Payment</button>
    </div>
  </div>
</div>

<!-- Payment Modal -->
<div class="modal" id="paymentModal" role="dialog" aria-labelledby="paymentTitle" aria-hidden="true">
  <div class="sheet">
    <div class="sheetHead">
      <b id="paymentTitle">Complete Payment</b>
      <button class="btn secondary" id="closePayment" aria-label="Close payment">Back</button>
    </div>
    <div class="sheetBody">
      <h4 style="margin:0 0 10px 0;">Select Payment Method</h4>

      <div class="payment-options" id="paymentOptions">
        <div class="payment-option" data-method="paystack">
          <div class="icon">üì±</div>
          <div class="name">M-Pesa STK Push</div>
          <div class="desc">Auto-pay on phone</div>
        </div>

        <div class="payment-option" data-method="mpesa">
          <div class="icon">üí≥</div>
          <div class="name">MPesa Manual</div>
          <div class="desc">Pay via MPesa</div>
        </div>

        <div class="payment-option" data-method="bank">
          <div class="icon">üè¶</div>
          <div class="name">Bank Transfer</div>
          <div class="desc">Send to bank account</div>
        </div>

        <div class="payment-option" data-method="cash">
          <div class="icon">üí∞</div>
          <div class="name">Cash</div>
          <div class="desc">Pay at counter</div>
        </div>
      </div>

      <!-- Paystack STK Push Payment Details -->
      <div class="payment-details hidden" id="paystackDetails">
        <h4>M-Pesa STK Push Payment</h4>
        
        <div style="margin:20px 0;">
          <label style="display:block; margin-bottom:8px; font-weight:700;">
            M-Pesa Registered Phone
          </label>
          <input type="tel" id="paystackPhone" 
                 placeholder="2547XXXXXXXX"
                 class="phone-input"
                 value="2547">
          <p style="font-size:12px; color:#666; margin-top:5px;">
            You'll receive an M-Pesa prompt on this phone
          </p>
        </div>
        
        <div style="background:#f0f9ff; border:1px solid #b6e0fe; border-radius:10px; padding:12px; margin:15px 0;">
          <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
            <span>Table:</span>
            <strong id="paystackTable">--</strong>
          </div>
          <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
            <span>Amount:</span>
            <strong id="paystackAmount">KES 0</strong>
          </div>
          <div style="display:flex; justify-content:space-between;">
            <span>Reference:</span>
            <strong id="paystackReference">GS-ORDER-</strong>
          </div>
        </div>
        
        <div class="paystack-processing" id="paystackProcessing" style="display:none;">
          <div class="spinner"></div>
          <p>Sending payment request to your phone...</p>
          <p style="font-size:12px;">Check your phone for M-Pesa PIN prompt</p>
        </div>
        
        <button class="btn success" id="initiatePaystack" style="width:100%; padding:14px; font-size:16px;">
          üì± Send Payment Request to Phone
        </button>
        
        <p style="font-size:11px; color:#666; text-align:center; margin-top:15px;">
          ‚ö° Check your phone for M-Pesa PIN request
        </p>
      </div>

      <!-- MPesa Payment Details -->
      <div class="payment-details hidden" id="mpesaDetails">
        <h4>MPesa Payment Instructions</h4>
        <div class="mpesa-details">
          <div class="mpesa-row">
            <span>Business No (Till):</span>
            <strong id="mpesaTill">888555</strong>
            <button class="copy-btn" data-copy="888555">Copy</button>
          </div>
          <div class="mpesa-row" style="margin-top:8px;">
            <span>Account/Ref:</span>
            <strong id="mpesaRef">TABLE-</strong>
            <button class="copy-btn" id="copyMpesaRef">Copy</button>
          </div>
          <div class="mpesa-row" style="margin-top:8px;">
            <span>Amount:</span>
            <strong id="mpesaAmount">KES 0</strong>
            <button class="copy-btn" id="copyMpesaAmount">Copy</button>
          </div>
        </div>
        <p style="font-size:12px; color:var(--muted2); margin:10px 0;">
          üì± MPesa ‚Üí Lipa Na MPesa ‚Üí Buy Goods ‚Üí Enter Till <strong id="mpesaTill2">888555</strong><br>
          üí° Use reference: <strong id="mpesaTable">--</strong>
        </p>
        <button class="btn success" id="confirmMpesa">I have paid via MPesa</button>
      </div>

      <!-- Bank Payment Details -->
      <div class="payment-details hidden" id="bankDetails">
        <h4>Bank Transfer Details</h4>
        <div style="background:rgba(16,20,21,.03); border:1px solid rgba(16,20,21,.10); border-radius:10px; padding:12px;">
          <div class="mpesa-row">
            <span>Bank:</span>
            <strong id="bankName">KCB Bank</strong>
            <button class="copy-btn" data-copy="KCB Bank">Copy</button>
          </div>
          <div class="mpesa-row" style="margin-top:8px;">
            <span>Account No:</span>
            <strong id="bankAcc">0123456789</strong>
            <button class="copy-btn" data-copy="0123456789">Copy</button>
          </div>
          <div class="mpesa-row" style="margin-top:8px;">
            <span>Account Name:</span>
            <strong id="bankAccName">GOLDEN STAR RESTAURANT</strong>
            <button class="copy-btn" data-copy="GOLDEN STAR RESTAURANT">Copy</button>
          </div>
          <div class="mpesa-row" style="margin-top:8px;">
            <span>Reference:</span>
            <strong id="bankRef">TABLE-</strong>
            <button class="copy-btn" id="copyBankRef">Copy</button>
          </div>
          <div class="mpesa-row" style="margin-top:8px;">
            <span>Amount:</span>
            <strong id="bankAmount">KES 0</strong>
            <button class="copy-btn" id="copyBankAmount">Copy</button>
          </div>
        </div>

        <p style="font-size:12px; color:var(--muted2); margin:10px 0;">
          üè¶ Please use reference: <strong id="bankTable">--</strong>
        </p>

        <button class="btn success" id="confirmBank">I have sent bank transfer</button>
      </div>

      <!-- Cash Payment Details -->
      <div class="payment-details hidden" id="cashDetails">
        <h4>Cash Payment</h4>
        <p style="font-size:13px; color:var(--muted2); margin-bottom:15px;">
          Pay at the counter. Your order will be prepared immediately.
        </p>
        <div style="background:#f8f8f8; padding:12px; border-radius:8px; margin-bottom:15px;">
          <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
            <span>Order Total:</span>
            <strong id="cashAmount">KES 0</strong>
          </div>
          <div style="display:flex; justify-content:space-between; font-size:13px;">
            <span>Table:</span>
            <strong id="cashTable">--</strong>
          </div>
        </div>
        <button class="btn success" id="confirmCash">Confirm Cash Order</button>
      </div>
    </div>
  </div>
</div>

<!-- Success Modal -->
<div class="modal" id="successModal" role="dialog" aria-labelledby="successTitle" aria-hidden="true">
  <div class="sheet">
    <div class="sheetHead">
      <b id="successTitle">Order Confirmed! üéâ</b>
    </div>
    <div class="success-screen">
      <div class="success-icon">‚úÖ</div>
      <h3>Order Received Successfully!</h3>
      <p>Your order has been sent to the kitchen. You will receive your food shortly.</p>

      <div class="order-id" id="orderId">ORDER-#GS-001</div>

      <div style="background:#f8f8f8; padding:15px; border-radius:10px; text-align:left; margin:15px 0;">
        <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
          <span>Table:</span>
          <strong id="successTable">--</strong>
        </div>
        <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
          <span>Items:</span>
          <strong id="successItems">0</strong>
        </div>
        <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
          <span>Total:</span>
          <strong id="successTotal">KES 0</strong>
        </div>
        <div style="display:flex; justify-content:space-between;">
          <span>Payment:</span>
          <strong id="successPayment">--</strong>
        </div>
      </div>

      <p style="font-size:13px; color:var(--muted2);">
        üìã Order details sent to kitchen<br>
        ‚è±Ô∏è Estimated time: 15-20 minutes
      </p>

      <button class="btn" id="sendWhatsApp">üì± Send to My WhatsApp</button>
      <button class="btn secondary" id="newOrder">Start New Order</button>
    </div>
  </div>
</div>

<script src="menu.js" defer></script>

<script>
/* ========= PAYSTACK STK PUSH INTEGRATION =========
   This layer integrates PayStack M-Pesa STK Push into your existing menu
   - Customer enters phone ‚Üí Gets PIN prompt
   - Works with your existing cart system
*/

// PAYSTACK CONFIGURATION - USE YOUR LIVE KEYS
const PAYSTACK_CONFIG = {
  // TEST KEYS (for testing)
  // publicKey: "pk_test_929f9c92fa658760bb56bd96a63fa91619c94c3",
  
  // LIVE KEYS (for production - USE THESE)
  publicKey: "pk_live_1aede7667d50adb2147614cb580a9513552c0aa9",
  
  restaurantName: "Golden Star Restaurant",
  restaurantEmail: "orders@goldenstar.co.ke"
};

const CONFIG = {
  restaurantName: "Golden Star Restaurant",
  whatsappTo: "", 
  mpesaTill: "888555",
  bankName: "KCB Bank",
  bankAccount: "0123456789",
  bankAccountName: "GOLDEN STAR RESTAURANT",
};

const el = (id) => document.getElementById(id);
const fmtKES = (n) => `KES ${Number(n || 0).toLocaleString("en-KE")}`;

let selectedPayment = "";
let lastOrderPayload = null;
let paystackInitialized = false;

// Initialize Paystack
function initPaystack() {
  if (paystackInitialized) return;
  
  const script = document.createElement('script');
  script.src = "https://js.paystack.co/v1/inline.js";
  script.onload = () => {
    console.log("Paystack loaded");
    paystackInitialized = true;
  };
  document.head.appendChild(script);
}

function getTableLabel(){
  const v = el("tableNumber").value;
  if (!v) return "";
  return v.toString().startsWith("Table") || v.toString().startsWith("VIP") || v === "Take Away" || v === "Delivery"
    ? v
    : `Table ${v}`;
}

function requireTable(){
  const t = getTableLabel();
  if (!t){
    alert("Please select your table before checkout.");
    el("tableNumber").focus();
    return false;
  }
  return true;
}

/* ---- Hook table selection -> UI ---- */
el("tableNumber").addEventListener("change", () => {
  const t = getTableLabel();
  el("currentTable").textContent = t || "No Table Selected";
  el("modalTable").textContent = `Table: ${t || "--"}`;

  // Update refs
  const ref = t ? t.replace(/\s+/g,"-").toUpperCase() : "TABLE-";
  el("mpesaRef").textContent = ref;
  el("mpesaTable").textContent = ref;
  el("bankRef").textContent = ref;
  el("bankTable").textContent = ref;
  el("cashTable").textContent = t || "--";
  el("paystackTable").textContent = t || "--";
  el("paystackReference").textContent = `GS-${t ? t.replace(/\s+/g,"") : "ORDER"}-${Date.now().toString().slice(-6)}`;
});

/* ---- Cart modal open/close ---- */
el("openCart").addEventListener("click", () => el("cartModal").classList.add("open"));
el("closeCart").addEventListener("click", () => el("cartModal").classList.remove("open"));
el("closePayment").addEventListener("click", () => el("paymentModal").classList.remove("open"));

el("proceedToPayment").addEventListener("click", () => {
  if (!requireTable()) return;
  el("cartModal").classList.remove("open");
  el("paymentModal").classList.add("open");
  refreshAmountsInPaymentPanels();
  initPaystack(); // Initialize Paystack when payment modal opens
});

/* ---- Payment method selection ---- */
document.querySelectorAll(".payment-option").forEach(opt => {
  opt.addEventListener("click", () => {
    document.querySelectorAll(".payment-option").forEach(x => x.classList.remove("selected"));
    opt.classList.add("selected");
    selectedPayment = opt.dataset.method;

    // show relevant panel
    ["mpesa","bank","cash","paystack"].forEach(m => {
      el(m + "Details").classList.add("hidden");
    });
    el(selectedPayment + "Details").classList.remove("hidden");
  });
});

/* ---- Copy buttons ---- */
document.addEventListener("click", async (e) => {
  const btn = e.target.closest(".copy-btn");
  if (!btn) return;

  let v = btn.getAttribute("data-copy");
  if (!v && btn.id === "copyMpesaRef") v = el("mpesaRef").textContent;
  if (!v && btn.id === "copyBankRef") v = el("bankRef").textContent;
  if (!v && btn.id === "copyMpesaAmount") v = String(getCartTotal());
  if (!v && btn.id === "copyBankAmount") v = String(getCartTotal());

  try{
    await navigator.clipboard.writeText(v || "");
    btn.textContent = "Copied";
    setTimeout(()=> btn.textContent = "Copy", 900);
  }catch{
    alert("Copy failed. Please copy manually.");
  }
});

/* ---- Amount sync ---- */
function refreshAmountsInPaymentPanels(){
  const total = getCartTotal();
  const t = getTableLabel();

  el("mpesaTill").textContent = CONFIG.mpesaTill;
  el("mpesaTill2").textContent = CONFIG.mpesaTill;
  el("mpesaAmount").textContent = fmtKES(total);

  el("bankName").textContent = CONFIG.bankName;
  el("bankAcc").textContent = CONFIG.bankAccount;
  el("bankAccName").textContent = CONFIG.bankAccountName;
  el("bankAmount").textContent = fmtKES(total);

  el("cashAmount").textContent = fmtKES(total);
  el("cashTable").textContent = t || "--";

  // Paystack amounts
  el("paystackAmount").textContent = fmtKES(total);
  el("paystackTable").textContent = t || "--";
}

/* ---- Get cart info (compatible with your menu.js) ---- */
function getCartItems(){
  // If your menu.js stores cart in window.CART or window.cart, this will work.
  const c = window.CART || window.cart || [];
  // Expected item shape: {name, price, qty}
  if (Array.isArray(c) && c.length) return c;

  // Fallback: try reading from rendered lines in cart modal
  const lines = [];
  document.querySelectorAll("#cartLines .line").forEach(node => {
    const name = node.querySelector(".info b")?.textContent?.trim();
    const sub = node.querySelector(".info small")?.textContent?.trim() || "";
    // try parse "KES" from sub
    const priceMatch = sub.match(/KES\s*([\d,]+)/i);
    const price = priceMatch ? Number(priceMatch[1].replace(/,/g,"")) : 0;
    // qty from middle element if present
    const qtyText = node.querySelector(".qty span")?.textContent?.trim();
    const qty = qtyText ? Number(qtyText) : 1;
    if (name) lines.push({ name, price, qty });
  });
  return lines;
}

function getCartTotal(){
  const items = getCartItems();
  return items.reduce((sum, it) => sum + (Number(it.price||0) * Number(it.qty||1)), 0);
}

function getCartCount(){
  const items = getCartItems();
  return items.reduce((sum, it) => sum + Number(it.qty||1), 0);
}

function generateOrderId(){
  const d = new Date();
  const y = d.getFullYear().toString().slice(-2);
  const m = String(d.getMonth()+1).padStart(2,"0");
  const day = String(d.getDate()).padStart(2,"0");
  const rand = Math.floor(100 + Math.random()*900);
  return `GS-${y}${m}${day}-${rand}`;
}

function buildWhatsAppMessage(payload){
  const lines = payload.items.map(it => `‚Ä¢ ${it.name} x${it.qty} ‚Äî ${fmtKES(it.price * it.qty)}`);
  return [
    `*${CONFIG.restaurantName} ‚Äî Order*`,
    `Order ID: *${payload.orderId}*`,
    `Table: *${payload.table}*`,
    `Payment: *${payload.paymentLabel}*`,
    ``,
    `Items:`,
    ...lines,
    ``,
    `Total: *${fmtKES(payload.total)}*`,
    ``,
    `Note: Please confirm when received.`
  ].join("\n");
}

/* ========= PAYSTACK STK PUSH INTEGRATION ========= */
el("initiatePaystack").addEventListener("click", function() {
  const phone = el("paystackPhone").value.trim();
  const amount = getCartTotal();
  const table = getTableLabel();
  
  if (!phone.match(/^2547\d{8}$/)) {
    alert("Please enter valid Kenyan phone number (2547XXXXXXXX)");
    el("paystackPhone").focus();
    return;
  }
  
  if (!table) {
    alert("Please select your table first");
    return;
  }
  
  if (amount <= 0) {
    alert("Your cart is empty");
    return;
  }
  
  if (!paystackInitialized) {
    alert("Payment system is loading. Please try again in a moment.");
    return;
  }
  
  // Show processing
  el("paystackProcessing").style.display = "block";
  el("initiatePaystack").disabled = true;
  el("initiatePaystack").textContent = "Processing...";
  
  // Generate unique reference
  const reference = `GS-${table.replace(/\s+/g,"")}-${Date.now().toString().slice(-6)}`;
  
  // Initialize Paystack payment
  const handler = PaystackPop.setup({
    key: PAYSTACK_CONFIG.publicKey,
    email: PAYSTACK_CONFIG.restaurantEmail,
    amount: amount * 100, // Paystack expects amount in kobo/cents
    currency: "KES",
    ref: reference,
    metadata: {
      custom_fields: [
        {
          display_name: "Table",
          variable_name: "table",
          value: table
        },
        {
          display_name: "Phone",
          variable_name: "phone",
          value: phone
        }
      ]
    },
    channels: ['mobile_money'],
    callback: function(response) {
      // Payment successful
      el("paystackProcessing").style.display = "none";
      el("initiatePaystack").disabled = false;
      el("initiatePaystack").textContent = "üì± Send Payment Request to Phone";
      
      // Store payment reference for record
      window.paymentReference = response.reference;
      window.paymentConfirmed = true;
      
      // Finalize the order
      finalizeOrder("M-Pesa STK Push");
    },
    onClose: function() {
      // Payment cancelled
      el("paystackProcessing").style.display = "none";
      el("initiatePaystack").disabled = false;
      el("initiatePaystack").textContent = "üì± Send Payment Request to Phone";
      
      if (!window.paymentConfirmed) {
        alert("Payment was cancelled. You can try again.");
      }
    }
  });
  
  // Open Paystack modal with phone pre-filled for M-Pesa
  handler.openIframe();
  
  // Set timeout to reset button
  setTimeout(() => {
    el("paystackProcessing").style.display = "none";
    el("initiatePaystack").disabled = false;
    el("initiatePaystack").textContent = "üì± Send Payment Request to Phone";
  }, 30000); // 30 second timeout
});

/* ---- Confirm order handlers (MPesa/Bank/Cash) ---- */
function finalizeOrder(paymentLabel){
  if (!requireTable()) return;

  const items = getCartItems();
  if (!items.length){
    alert("Your cart is empty.");
    return;
  }

  const orderId = generateOrderId();
  const payload = {
    orderId,
    table: getTableLabel(),
    paymentLabel,
    items,
    total: getCartTotal(),
    count: getCartCount()
  };

  lastOrderPayload = payload;

  // Success UI
  el("paymentModal").classList.remove("open");
  el("successModal").classList.add("open");

  el("orderId").textContent = `ORDER-#${orderId}`;
  el("successTable").textContent = payload.table;
  el("successItems").textContent = String(payload.count);
  el("successTotal").textContent = fmtKES(payload.total);
  el("successPayment").textContent = payload.paymentLabel;
}

el("confirmMpesa").addEventListener("click", () => finalizeOrder("MPesa Manual"));
el("confirmBank").addEventListener("click", () => finalizeOrder("Bank Transfer"));
el("confirmCash").addEventListener("click", () => finalizeOrder("Cash"));

/* ---- WhatsApp send ---- */
el("sendWhatsApp").addEventListener("click", () => {
  if (!lastOrderPayload) return;

  const msg = buildWhatsAppMessage(lastOrderPayload);
  const encoded = encodeURIComponent(msg);

  const to = (CONFIG.whatsappTo || "").replace(/\D/g,"");
  const url = to
    ? `https://wa.me/${to}?text=${encoded}`
    : `https://wa.me/?text=${encoded}`;

  window.open(url, "_blank");
});

/* ---- New order ---- */
el("newOrder").addEventListener("click", () => {
  el("successModal").classList.remove("open");
  lastOrderPayload = null;

  // Optional: clear cart if your menu.js exposes a clear function
  if (typeof window.clearCart === "function") window.clearCart();

  // Refresh UI bits
  el("summary").textContent = "No items yet";
  el("count").textContent = "0";
  el("checkoutBtn").disabled = true;
  el("paystackPhone").value = "2547";
  
  // Reset payment confirmation
  window.paymentConfirmed = false;
});

/* ---- Minimum enforcement: disable checkout until table + items ---- */
function tick(){
  const hasItems = getCartCount() > 0;
  const hasTable = !!getTableLabel();
  el("checkoutBtn").disabled = !(hasItems && hasTable);
  
  // Update Paystack button text with amount
  const paystackBtn = el("initiatePaystack");
  if (paystackBtn) {
    const amount = getCartTotal();
    paystackBtn.textContent = amount > 0 
      ? `üì± Pay KES ${amount.toLocaleString()} via M-Pesa`
      : `üì± Send Payment Request to Phone`;
  }
  
  requestAnimationFrame(tick);
}
tick();

/* ---- Initialize ---- */
refreshAmountsInPaymentPanels();
initPaystack(); // Initialize Paystack on page load
</script>
</body>
</html>
